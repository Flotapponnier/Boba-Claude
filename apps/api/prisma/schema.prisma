// Boba Claude Database Schema
// Using SQLite for simplicity

datasource db {
  provider = "sqlite"
  url      = "file:../data/boba-claude.db"
}

generator client {
  provider = "prisma-client-js"
}

// User accounts (simple auth for MVP)
model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String   // bcrypt hashed
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tokens    Token[]
  sessions  Session[]
}

// Encrypted API tokens (Claude, OpenAI, etc)
model Token {
  id        String   @id @default(uuid())
  userId    String
  vendor    String   // "anthropic", "openai"
  token     String   // Encrypted with crypto
  expiresAt DateTime?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, vendor])
  @@index([userId])
}

// Claude conversation sessions
model Session {
  id          String   @id @default(uuid())
  userId      String
  claudeId    String?  // Claude session ID from SDK
  name        String   // "Conversation about..."
  lastMessage String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([claudeId])
}
